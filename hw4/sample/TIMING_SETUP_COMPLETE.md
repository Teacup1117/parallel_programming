# âœ… æ€§èƒ½æ¸¬é‡åŠŸèƒ½å·²æ·»åŠ 

## ğŸ¯ å·²æ·»åŠ çš„åŠŸèƒ½

### 1. **Per-Block æ¸¬é‡**
æ¯å€‹ block çµæŸæ™‚æœƒè¼¸å‡ºï¼š
```
Found in batch #1 (searched 0 million nonces)
Total search time: 45 ms
Total solve time: 123 ms
```

- `search time` - GPU æœå°‹è€—æ™‚
- `solve time` - æ•´å€‹ block çš„è€—æ™‚ï¼ˆåŒ…å«æ‰€æœ‰ CPU è¨ˆç®—ï¼‰

### 2. **ç¸½ç¨‹åºåŸ·è¡Œæ™‚é–“**
ç¨‹åºçµæŸæ™‚æœƒè¼¸å‡ºï¼š
```
=====================================
Total program execution time: 1234 ms
=====================================
```

---

## ğŸ“Š å¦‚ä½•é‹è¡Œå’Œåˆ†æ

### ç¬¬ 1 æ­¥ï¼šç·¨è­¯
```bash
cd /Users/zhangguangcheng/pp25/hw4/sample
make clean
make
```

### ç¬¬ 2 æ­¥ï¼šé‹è¡Œä¸¦è¨˜éŒ„çµæœ
```bash
./hw4 testcases/case01.in outputs/case01.out
```

### ç¬¬ 3 æ­¥ï¼šæŸ¥çœ‹è¼¸å‡º
è¼¸å‡ºæœƒé¡ä¼¼ï¼š
```
merkle root(little): ...
Target value (big): ...
Searching for nonce using GPU...
Found Solution!!
nonce: 5ea01346 (0x5ea01346)
Found in batch #1 (searched 0 million nonces)
Total search time: 45 ms

Total solve time: 100 ms

Block 2...
Block 3...
Block 4...

=====================================
Total program execution time: 450 ms
=====================================
```

---

## ğŸ’¡ æ€§èƒ½åˆ†æçš„é—œéµæŒ‡æ¨™

### æŒ‡æ¨™ 1ï¼šGPU æœå°‹æ™‚é–“
```
search time = GPU è¨ˆç®—çš„å¯¦éš›è€—æ™‚
```

- å¦‚æœ <50msï¼šç­”æ¡ˆåœ¨å‰é¢ï¼Œå¾ˆé›£å„ªåŒ–
- å¦‚æœ 50-200msï¼šä¸­ç­‰é›£åº¦ï¼Œå¯å˜—è©¦åƒæ•¸èª¿æ•´
- å¦‚æœ >500msï¼šç­”æ¡ˆåœ¨å¾ˆå¾Œé¢ï¼Œéœ€è¦å¤§å¹…å„ªåŒ–

### æŒ‡æ¨™ 2ï¼šç¸½è§£æ±ºæ™‚é–“
```
solve time = search time + CPU é–‹éŠ·
             = GPU æœå°‹ + merkle root + block æº–å‚™ + SHA256 é©—è­‰
```

- å¦‚æœ `solve time - search time` > 100msï¼šCPU é–‹éŠ·å¤§
- å¦‚æœ `solve time - search time` < 50msï¼šä¸»è¦ç“¶é ¸æ˜¯ GPU

### æŒ‡æ¨™ 3ï¼šç¸½ç¨‹åºæ™‚é–“
```
total program time â‰ˆ 4 Ã— average solve timeï¼ˆå› ç‚ºæœ‰ 4 å€‹ blocksï¼‰
```

---

## ğŸ“ å°æ‡‰ä¹‹å‰çš„å•é¡Œ

### Q: ç‚ºä»€éº¼æ”¹åƒæ•¸æ²’æœ‰æ•ˆæœï¼Ÿ

ç¾åœ¨ä½ å¯ä»¥ç”¨é€™å€‹æ¸¬é‡å·¥å…·ä¾†é©—è­‰ï¼š

1. **é‹è¡Œç•¶å‰é…ç½®**ï¼Œè¨˜éŒ„æ™‚é–“
2. **æ”¹è®Š batch_size**ï¼ˆ10M â†’ 50M â†’ 100Mï¼‰ï¼Œåˆ†åˆ¥è¨˜éŒ„
3. **å°æ¯” `Total program execution time`**

**é æœŸçµæœ**ï¼š
- å°çš„ blocksï¼ˆ<100msï¼‰ï¼šæ”¹åƒæ•¸ç„¡æ•ˆ
- å¤§çš„ blocksï¼ˆ>500msï¼‰ï¼šå¯èƒ½æœ‰ 20-50% æ”¹é€²

---

## ğŸ”¬ é€²éšè¨ºæ–·

### å¦‚æœ Block 3 ä¸€ç›´å¾ˆæ…¢ï¼ˆ>1000msï¼‰
```
Block 3: Total search time: 2500 ms
```

å¯ä»¥å˜—è©¦ï¼š
1. å¢åŠ  `batch_size` å¾ 10M åˆ° 100M
2. å¢åŠ  `blocksPerGrid` å¾ 1024 åˆ° 4096
3. å¢åŠ  `threadsPerBlock` å¾ 256 åˆ° 512

ç„¶å¾Œé‡æ–°æ¸¬é‡ `Total program execution time`

### å¦‚æœç¸½æ™‚é–“é‚„æ˜¯æ²’æœ‰æ”¹å–„
èªªæ˜æ¶æ§‹ï¼ˆä¸²è¡Œ batchï¼‰æ˜¯ç“¶é ¸ï¼Œéœ€è¦ï¼š
1. ä½¿ç”¨ CUDA Streamsï¼ˆå¤šå€‹ batch ä¸¦è¡Œï¼‰
2. ä½¿ç”¨ Pinned Memory
3. ä½¿ç”¨ç•°æ­¥ memcpy

---

## âœ… ç¸½çµ

ç¾åœ¨ä½ æœ‰äº†å®Œæ•´çš„æ€§èƒ½æ¸¬é‡å·¥å…·ï¼Œå¯ä»¥ï¼š
1. âœ… ç²¾ç¢ºæ¸¬é‡å„ block çš„è€—æ™‚
2. âœ… è¨ºæ–·çœŸæ­£çš„æ€§èƒ½ç“¶é ¸
3. âœ… åŸºæ–¼æ•¸æ“šæ±ºå®šæ˜¯å¦å„ªåŒ–åƒæ•¸
4. âœ… é©—è­‰ä»»ä½•æ”¹è®Šçš„æ•ˆæœ

**ä¸‹ä¸€æ­¥**ï¼šé‹è¡Œæ¸¬è©¦ï¼Œçœ‹çœ‹å¯¦éš›çš„æ€§èƒ½æ•¸æ“šï¼
